{% load static %}

<!DOCTYPE html>
<html lang='en' data-theme='light'>
    <head>
        <meta charset='utf-8'>
        <meta name='viewport' content='width=device-width, initial-scale=1, shrink-to-fit=no'>
        <meta name='description' content='Smart Scan - Your food tracking application'>

        <link rel='icon' type='image/x-icon' href='{% static "images/favicon.ico" %}'>
        <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css' rel='stylesheet'>
        <link href='https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&display=swap' rel='stylesheet'>
        <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css' rel='stylesheet'>
        <link href='https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css' rel='stylesheet'>
        <link href='{% static "css/styles.css" %}' rel='stylesheet'>
        <link href='{% static "css/darkmode.css" %}' rel='stylesheet'>

        <title>{% block title %}Smart Scan{% endblock %}</title>
        
        <style>
            :root {
                --primary-color: #4361ee;
                --secondary-color: #3f37c9;
                --accent-color: #4cc9f0;
                --light-color: #f8f9fa;
                --dark-color: #212529;
                --success-color: #4bb543;
                --warning-color: #ffcc00;
                --danger-color: #ff3333;
                
                --transition-speed: 0.3s;
                --border-radius: 12px;
                --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
                --box-shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.15);
            }
            
            body {
                font-family: 'Poppins', sans-serif;
                background-color: var(--light-color);
                color: var(--dark-color);
                display: flex;
                flex-direction: column;
                min-height: 100vh;
                transition: background-color var(--transition-speed) ease;
            }
            
            main {
                flex: 1;
                padding: 2rem 0;
            }
            
            /* Navbar */
            .navbar {
                box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
                padding: 0.8rem 1rem;
                background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            }
            
            .navbar-brand {
                font-weight: 700;
                font-size: 1.5rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }
            
            .navbar-brand i {
                color: #fff;
                transition: transform 0.3s ease;
            }
            
            .navbar-brand:hover i {
                transform: rotate(15deg);
            }
            
            .nav-link {
                font-weight: 500;
                padding: 0.5rem 1rem;
                border-radius: var(--border-radius);
                margin: 0 0.2rem;
                transition: all var(--transition-speed) ease;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }
            
            .nav-link:hover {
                background-color: rgba(255, 255, 255, 0.15);
                transform: translateY(-2px);
            }
            
            .dropdown-menu {
                border: none;
                box-shadow: var(--box-shadow);
                border-radius: var(--border-radius);
                padding: 0.5rem 0;
                margin-top: 0.5rem;
            }
            
            .dropdown-item {
                padding: 0.5rem 1.5rem;
                transition: all var(--transition-speed) ease;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }
            
            .dropdown-item:hover {
                background-color: rgba(67, 97, 238, 0.1);
                transform: translateX(5px);
            }
            
            /* Dark mode toggle */
            #darkModeToggle {
                border: none;
                background: transparent;
                font-size: 1.2rem;
                cursor: pointer;
                transition: transform 0.3s ease;
                margin-left: 0.5rem;
                padding: 0.5rem;
            }
            
            #darkModeToggle:hover {
                transform: scale(1.2) rotate(30deg);
            }
            
            /* Container */
            .container {
                max-width: 1200px;
                padding: 0 1.5rem;
            }
            
            /* Footer */
            footer {
                background-color: var(--primary-color);
                color: white;
                padding: 1.5rem 0;
                margin-top: 2rem;
                box-shadow: 0 -2px 15px rgba(0, 0, 0, 0.1);
            }
            
            footer a {
                color: white;
                text-decoration: none;
                transition: color var(--transition-speed) ease;
            }
            
            footer a:hover {
                color: var(--accent-color);
            }
            
            /* Badges */
            .badge {
                font-weight: 500;
                padding: 0.35em 0.65em;
            }
            
            /* Animations */
            .animate-pop {
                animation: pop 0.3s ease;
            }
            
            @keyframes pop {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }
            
            /* Dark mode specific styles */
            [data-theme="dark"] {
                --light-color: #1a1a1a;
                --dark-color: #f8f9fa;
                --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                --box-shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.4);
            }
            
            [data-theme="dark"] .navbar {
                background: linear-gradient(135deg, #3a56e8, #3830b8);
                box-shadow: 0 2px 15px rgba(0, 0, 0, 0.3);
            }
            
            [data-theme="dark"] .dropdown-menu {
                background-color: #2a2a2a;
                border: 1px solid #444;
            }
            
            [data-theme="dark"] .dropdown-item {
                color: #f8f9fa;
            }
            
            [data-theme="dark"] .dropdown-item:hover {
                background-color: rgba(67, 97, 238, 0.3);
            }
            
            /* Responsive adjustments */
            @media (max-width: 992px) {
                .navbar-collapse {
                    padding: 1rem 0;
                }
                
                .nav-link {
                    margin: 0.2rem 0;
                }
                
                .dropdown-menu {
                    margin-left: 1rem;
                    width: calc(100% - 2rem);
                }
            }
        </style>
    </head>

    <body>
        <nav class='navbar navbar-expand-lg navbar-dark sticky-top'>
            <div class='container-fluid'>
                <a class='navbar-brand animate__animated animate__fadeIn' href="{% url 'index' %}">
                    <i class='fas fa-pepper-hot'></i> Smart Scan
                </a>
                <button class='navbar-toggler' type='button' data-bs-toggle='collapse' data-bs-target='#navbarColor' aria-controls='navbarColor' aria-expanded='false' aria-label='Toggle navigation'>
                    <span class='navbar-toggler-icon'></span>
                </button>
                
                <div class='collapse navbar-collapse' id='navbarColor'>
                    <ul class='navbar-nav me-auto'>
                        <li class='nav-item'>
                            <a class='nav-link' href="{% url 'index' %}">
                                <i class='fas fa-list'></i> Food List
                            </a>
                        </li>
                        
                        {% if user.is_authenticated %}
                        <li class='nav-item'>
                            <a class='nav-link' href="{% url 'water_tracker' %}">
                                <i class='fas fa-tint'></i> Water Tracker
                            </a>
                        </li>
                        {% endif %}
                        
                        <li class='nav-item dropdown'>
                            <a class='nav-link dropdown-toggle' data-bs-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false'>
                                <i class='fas fa-pizza-slice'></i> Food Categories
                            </a>
                            <div class='dropdown-menu animate__animated animate__fadeIn'>
                                {% for category in categories %}
                                <a class='dropdown-item' href="{% url 'category_details_view' category.category_name %}">
                                    <i class="fas fa-{{ category.icon|default:'tag' }} me-2"></i>
                                    {{ category }} &nbsp;
                                    <span class='badge bg-primary rounded-pill'>{{ category.count_food_by_category }}</span>
                                </a>
                                {% endfor %}
                            </div>
                        </li>
                        
                        {% if user.is_authenticated %}
                            <li class='nav-item'>
                                <a class='nav-link' href="{% url 'food_add' %}">
                                    <i class='far fa-plus-square'></i> Add Food Item
                                </a>
                            </li>
                            <li class='nav-item'>
                                <a class='nav-link' href="{% url 'food_log' %}">
                                    <i class='fas fa-utensils'></i> Food Log
                                </a>
                            </li>
                        {% endif %}
                    </ul>
                    <ul class='navbar-nav ms-auto'>
                        {% if user.is_authenticated %}
                        <li class='nav-item dropdown'>
                            <a class='nav-link dropdown-toggle d-flex align-items-center' data-bs-toggle='dropdown' href='#' role='button' aria-haspopup='true' aria-expanded='false'>
                                <i class='fas fa-user-circle me-1'></i>
                                <span class="d-none d-lg-inline">{{ user.username }}</span>
                            </a>
                            <div class='dropdown-menu dropdown-menu-end animate__animated animate__fadeIn'>
                                <a class='dropdown-item' href="{% url 'weight_log' %}">
                                    <i class='fas fa-user me-2'></i> User Profile
                                </a>
                                <div class='dropdown-divider'></div>
                                <a class='dropdown-item' href="{% url 'logout' %}">
                                    <i class='fas fa-sign-out-alt me-2'></i> Log Out
                                </a>
                            </div>
                        </li>
                        {% else %}
                        <li class='nav-item'>
                            <a class='nav-link' href="{% url 'login' %}">
                                <i class='fas fa-sign-in-alt'></i> Log In
                            </a>
                        </li>
                        <li class='nav-item'>
                            <a class='nav-link' href="{% url 'register' %}">
                                <i class='fas fa-user-plus'></i> Register
                            </a>
                        </li>
                        {% endif %}
                        
                        <!-- Dark Mode Toggle -->
                        <li class='nav-item d-flex align-items-center'>
                            <button id='darkModeToggle' class='btn' title="Toggle Dark Mode">🌙</button>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <main>
            <div class='container'>
                {% if messages %}
                <div class="row">
                    <div class="col-12">
                        {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show animate__animated animate__fadeInDown" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                {% block body %}
                {% endblock %}
            </div>
        </main>

        <footer class='py-4'>
            <div class='container'>
                <div class='row'>
                    <div class='col-md-6 text-center text-md-start'>
                        <p class='mb-0'>Copyright &copy; <script>document.write(new Date().getFullYear())</script> Omansh GN.Khalsa</p>
                    </div>
                    <div class='col-md-6 text-center text-md-end'>
                        <a href="#" class='me-3'><i class='fab fa-github'></i></a>
                        <a href="#" class='me-3'><i class='fab fa-twitter'></i></a>
                        <a href="#" class='me-3'><i class='fab fa-linkedin'></i></a>
                        <a href="#"><i class='fas fa-envelope'></i></a>
                    </div>
                </div>
            </div>
        </footer>

        {% block script %}
        <script src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js'></script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Dark Mode Toggle
                const darkModeToggle = document.getElementById('darkModeToggle');
                const html = document.documentElement;
                let currentTheme = localStorage.getItem('theme') || 'light';

                function applyTheme(theme) {
                    html.setAttribute('data-theme', theme);
                    darkModeToggle.innerText = theme === 'dark' ? '☀️' : '🌙';
                    localStorage.setItem('theme', theme);
                }

                if (darkModeToggle) {
                    applyTheme(currentTheme);

                    darkModeToggle.addEventListener('click', () => {
                        const newTheme = html.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
                        applyTheme(newTheme);
                        
                        darkModeToggle.classList.add('animate-pop');
                        setTimeout(() => {
                            darkModeToggle.classList.remove('animate-pop');
                        }, 300);
                    });
                }
                
                // Navbar hover animations
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('mouseenter', () => {
                        link.classList.add('animate__animated', 'animate__pulse');
                    });
                    link.addEventListener('animationend', () => {
                        link.classList.remove('animate__animated', 'animate__pulse');
                    });
                });
            });
        </script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            // Remove streak badge if it exists
            document.addEventListener('DOMContentLoaded', function() {
                const streakBadge = document.querySelector('.streak-badge');
                if (streakBadge) streakBadge.remove();
            });
        </script>
        {% endblock %}
        
    </body>
</html>
