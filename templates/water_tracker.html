<!-- In your dashboard.html -->
{% extends "base.html" %}
{% load static %}

{% block title %}Dashboard | Smart Scan{% endblock %}

{% block body %}
<div class="container py-4">
    <!-- Water Tracker Section -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">
                <i class="fas fa-tint me-2"></i>Water Tracker
                <span class="float-end">{{ today|date:"F j, Y" }}</span>
            </h5>
        </div>
        <div class="card-body">
            <!-- Progress Bar -->
            <div class="progress mb-3" style="height: 30px;">
                <div class="progress-bar progress-bar-striped bg-info" 
                     role="progressbar" 
                     style="width: {{ water_progress }}%"
                     id="water-progress-bar">
                    {{ water_intake.glasses }}/{{ water_goal.daily_goal }} glasses
                </div>
            </div>
            
            <!-- Controls -->
            <div class="text-center">
                <button id="remove-glass" class="btn btn-danger btn-sm">
                    <i class="fas fa-minus"></i> Remove
                </button>
                <span class="mx-3 fs-4" id="glass-count">{{ water_intake.glasses }}</span>
                <button id="add-glass" class="btn btn-success btn-sm">
                    <i class="fas fa-plus"></i> Add
                </button>
            </div>
        </div>
    </div>
{% endblock %}

{% block script %}
{{ block.super }}
<script>
// Water Tracker AJAX
document.addEventListener('DOMContentLoaded', function() {
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    
    function updateWater(action) {
        fetch("{% url 'log_water' %}", {
            method: 'POST',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': csrfToken,
            },
            body: `action=${action}`
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById('glass-count').textContent = data.glasses;
            const progressBar = document.getElementById('water-progress-bar');
            progressBar.style.width = `${data.progress}%`;
            progressBar.textContent = `${data.glasses}/${data.goal} glasses`;
        })
        .catch(error => console.error('Error:', error));
    }

    document.getElementById('add-glass').addEventListener('click', () => updateWater('add'));
    document.getElementById('remove-glass').addEventListener('click', () => updateWater('remove'));
});
</script>
{% endblock %}